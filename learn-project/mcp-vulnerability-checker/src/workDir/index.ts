import fs from "fs";

import { join } from "path";
import { uniqueId, getDirname } from "../common/utils.js";

const __dirname = getDirname(import.meta.url); // 获取当前文件的目录名

const basePath = join(__dirname, "../.."); // 获取上两级目录
const workBasePath = join(basePath, "work"); // 定义工作目录路径
fs.mkdirSync(workBasePath, { recursive: true }); // 确保工作目录存在

/**
 * 创建一个新的工作目录
 *
 * 该函数会在指定的基础路径下创建一个唯一命名的目录，用于临时工作空间
 *
 * @returns Promise<string> 返回创建的工作目录的完整路径
 */
export async function createWorkDir(): Promise<string> {
  const workDir = join(workBasePath, uniqueId());
  await fs.promises.mkdir(workDir, { recursive: true }); // 创建工作目录
  return workDir;
}

/**
 * 删除工作目录
 * @param workDir - 要删除的工作目录路径
 * @returns Promise<void> - 删除操作完成后的Promise
 */
export async function deleteWorkDir(workDir: string): Promise<void> {
  await fs.promises.rm(workDir, { recursive: true }); // 删除工作目录
}
