import { Vulnerability } from "../types/npmAudit.js";

export function getDepChain(
  node: Vulnerability,
  globalNodeMap: Record<string, Vulnerability>
): string[][] {
  const chains: string[][] = [];
  const currentPath: string[] = [];
  function dfs(currentNode: Vulnerability) {
    if (!currentNode) return;
    if (currentPath.includes(currentNode.name)) {
      chains.push([...currentPath]);
      return;
    }
    currentPath.unshift(currentNode.name);
    if (!currentNode.effects || currentNode.effects.length === 0) {
      chains.push([...currentPath]);
    } else {
      for (const effect of currentNode.effects) {
        dfs(globalNodeMap[effect]);
      }
    }
    currentPath.shift();
  }
  dfs(node);
  return chains;
}
