import { Vulnerability } from './npmAudit.js';

// 单条规范化后的包信息类型
export interface NormalizedPackage {
  name: string;
  severity: Vulnerability['severity']; // "info" | "low" | "moderate" | "high" | "critical"
  problems: Vulnerability['via'];
  effects: string[];
  range: string;
  nodes: string[];
  fixAvailable: Vulnerability['fixAvailable']; // 包修复信息
  depChains: string[][]; // 依赖链
}

// type VulnerabilityDetail =
//   | {
//       /** 漏洞数据源标识（数字 ID） */
//       source?: number;
//       /** 存在漏洞的依赖包名称（同 name，冗余字段用于兼容性） */
//       /** 漏洞标题（简要描述漏洞类型） */
//       title: string;
//       /** 漏洞详情链接（通常指向 GitHub Advisory） */
//       url?: string;
//       /** 该漏洞的具体严重级别 */
//       severity: Severity;
//       /** 漏洞对应的 CWE 编号列表 */
//       cwe?: string[];
//       /** CVSS 评分信息 */
//       cvss?: {
//         /** CVSS 评分（0-10，10 为最高风险） */
//         score: number;
//         /** CVSS 向量字符串 */
//         vectorString: string | null;
//       };
//       /** 受影响的版本范围 */
//       range?: string;
//     }
//   | string;
// 审计结果分桶类型（按严重级别）
export type Severity = Vulnerability['severity']; // 联合字面量类型
export type AuditBuckets = Record<Severity, NormalizedPackage[]>; // { info:[], low:[], ... }

export interface NormalizedAudit {
  vulnerabilities: AuditBuckets;
  summary?: {
    total: number;
    critical: number;
    high: number;
    moderate: number;
    low: number;
  };
}
